@page "/courses"
@inject StudentCourseApp.Services.CourseService CourseService
@inject NavigationManager Navigation

<h3>Courses</h3>

<div class="mb-3">
    <button class="btn btn-dark-purple" @onclick="GoToAddCourse">
        <i class="bi bi-plus-circle"></i> Add Course
    </button>
</div>

<table class="table table-striped table-hover shadow-sm">
    <thead class="table-dark">
        <tr>
            <th>Title</th>
            <th>Students Enrolled</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var course in courses)
        {
            <tr>
                <td>@course.Title</td>
                <td>@(course.Enrollments?.Count(e => e.IsActive) ?? 0)</td>
                <td>
                    <button class="btn btn-blue-purple btn-sm me-2" @onclick="() => ViewDetails(course.Id)">
                        Details
                    </button>
                    <button class="btn btn-deep-purple btn-sm" @onclick="() => OpenReport(course.Id)">
                        Generate Report
                    </button>
                    <button class="btn btn-navy btn-sm" @onclick="() => DeletedCourse(course.Id)">
                        Delete
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>

<div>
    <button class="btn btn-deep-purple btn-sm" @onclick="() => BackToHome()">
        Back To Home
    </button>
</div>

@code {
    private List<StudentCourseApp.Models.Course> courses = new();

    protected override async Task OnInitializedAsync()
    {
        // Include enrollments so student names are available immediately
        courses = await CourseService.GetAllWithEnrollments();
    }

    private void GoToAddCourse()
    {
        Navigation.NavigateTo("/courses/add");
    }

    private void ViewDetails(int id)
    {
        Navigation.NavigateTo($"/courses/details/{id}");
    }

    private void OpenReport(int id)
    {
        Navigation.NavigateTo($"/courses/report/{id}");
    }

    private void BackToHome()
    {
        Navigation.NavigateTo($"/");
    }

    private async Task DeletedCourse(int id)
    {
        await CourseService.Delete(id);
        courses = await CourseService.GetAll();
    }
        
    
}

